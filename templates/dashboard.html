<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRIVACY_WIPE_v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #00ff41; --bg: #000; --panel: rgba(0,20,0,0.8); --border: #004400; }
        .theme-matrix { --primary: #00ff41; --bg: #000; --border: #00ff41; }
        .theme-cyber { --primary: #00e5ff; --bg: #050510; --border: #00e5ff; }
        .theme-blood { --primary: #ff0000; --bg: #100000; --border: #ff0000; }

        body { background-color: var(--bg); color: var(--primary); font-family: 'Courier New', monospace; transition: 0.3s; }
        .cyber-box { border: 1px solid var(--border); background: var(--panel); box-shadow: 0 0 10px var(--primary); padding: 1.5rem; position: relative; overflow: hidden; margin-bottom: 20px; }
        .glow-btn { border: 1px solid var(--primary); color: var(--primary); background: transparent; transition: 0.3s; font-weight: bold; text-transform: uppercase; cursor: pointer; width: 100%; padding: 10px; }
        .glow-btn:hover { background: var(--primary); color: black; box-shadow: 0 0 15px var(--primary); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); justify-content: center; align-items: center; z-index: 100; }
        
        input { background: rgba(0,0,0,0.5); border: 1px solid var(--border); color: var(--primary); padding: 8px; width: 100%; outline: none; margin-bottom: 10px; }
    </style>
</head>
<body class="theme-matrix" id="app-body">

    <!-- HEADER -->
    <div class="flex justify-between items-center p-6 border-b border-[var(--border)] mb-6">
        <div>
            <h1 class="text-2xl font-bold italic tracking-widest"><i class="fas fa-shield-virus"></i> PRIVACY_WIPE_v4.0</h1>
            <p class="text-[10px] opacity-70">
                USER: {% if logged_in %} <span class="text-blue-400">{{ user }}</span> {% else %} <span class="text-yellow-500">GUEST</span> {% endif %}
            </p>
        </div>
        <div class="flex gap-4 items-center">
            <select onchange="setTheme(this.value)" class="bg-black border border-[var(--border)] text-[10px] p-1 text-[var(--primary)]">
                <option value="theme-matrix">MATRIX</option>
                <option value="theme-cyber">CYBERPUNK</option>
                <option value="theme-blood">RED_ALERT</option>
            </select>
            {% if logged_in %}
            <a href="/logout" class="text-red-500 text-[10px] font-bold border border-red-500 px-2 py-1 hover:bg-red-900">[LOGOUT]</a>
            {% endif %}
        </div>
    </div>

    <!-- MAIN TOOLS GRID -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6">

        <!-- TOOL 1: OSINT -->
        <div class="cyber-box">
            <h2 class="text-lg font-bold mb-1">01: OSINT HUB</h2>
            <p class="text-[9px] opacity-60 mb-4">SCAN DIGITAL FOOTPRINT (Free)</p>
            <input type="text" id="osint_target" placeholder="Enter Username">
            <button onclick="startOsint()" class="glow-btn">INITIATE_SCAN</button>
            <div id="osint_res" class="mt-4 h-24 overflow-auto text-[10px] border-t border-[var(--border)] pt-2"></div>
        </div>

        <!-- TOOL 2: BREACH LAB -->
        <div class="cyber-box">
            <h2 class="text-lg font-bold mb-1">02: BREACH LAB</h2>
            <p class="text-[9px] opacity-60 mb-4">CHECK LEAKED PASSWORDS (Free)</p>
            <input type="email" id="breach_target" placeholder="Enter Email">
            <button onclick="startBreach()" class="glow-btn">CHECK_DATABASE</button>
            <div id="breach_res" class="mt-4 h-24 overflow-auto text-[10px]"></div>
        </div>

        <!-- TOOL 3: FORENSIC LAB -->
        <div class="cyber-box">
            <h2 class="text-lg font-bold mb-1">03: FORENSIC LAB</h2>
            <p class="text-[9px] opacity-60 mb-4">IMAGE METADATA ANALYSIS (Free)</p>
            <input type="file" id="forensic_file" class="text-[10px]">
            <button onclick="startForensic()" class="glow-btn mt-2">ANALYZE_IMAGE</button>
            <div id="forensic_res" class="mt-4 h-24 overflow-auto text-[10px] text-yellow-500"></div>
        </div>

        <!-- TOOL 4: GLOBAL WIPE (PROTECTED) -->
        <div class="cyber-box md:col-span-2 lg:col-span-3 border-t-4" style="border-top-color: #ff0000;">
            <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-red-600">04: GLOBAL WIPE PROTOCOL</h2>
                    <p class="text-[10px] opacity-70">AUTOMATED DELETION REQUESTS TO 200,000 NODES. (LOGIN REQUIRED)</p>
                </div>
                <button onclick="startWipe()" class="glow-btn w-auto px-10 py-4 bg-red-900/20 text-red-500 border-red-500 hover:bg-red-600 hover:text-white mt-4 md:mt-0">
                    <i class="fas fa-radiation"></i> ACTIVATE_WIPE
                </button>
            </div>
            
            <!-- Progress Bar -->
            <div class="w-full bg-gray-900 h-4 mt-2 border border-red-900 rounded">
                <div id="wipe_bar" class="h-full bg-red-600 transition-all duration-300" style="width: 0%"></div>
            </div>
            <div id="wipe_log" class="mt-4 h-32 overflow-auto text-[10px] font-mono bg-black/50 p-2 border border-red-900/50">
                [SYSTEM] Awaiting Activation...
            </div>
        </div>

    </div>

    <!-- LOGIN MODAL (Popup) -->
    <div id="loginModal" class="modal">
        <div class="cyber-box w-96 text-center border-red-500 shadow-[0_0_50px_#ff0000]">
            <h2 class="text-2xl font-bold mb-2 text-red-500 italic">ACCESS_RESTRICTED</h2>
            <p class="text-xs mb-6 opacity-80">Wipe Protocol requires authentication.</p>
            
            <a href="/auth/google" class="glow-btn block py-3 flex items-center justify-center gap-2 mb-4 bg-white text-black hover:bg-gray-200">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5"> CONTINUE WITH GOOGLE
            </a>
            
            <button onclick="document.getElementById('loginModal').style.display='none'" class="text-[10px] underline opacity-50 hover:opacity-100 mt-4">CANCEL</button>
        </div>
    </div>

    <script>
        function setTheme(theme) {
            document.getElementById('app-body').className = "p-4 " + theme;
        }

        async function startOsint() {
            const target = document.getElementById('osint_target').value;
            const out = document.getElementById('osint_res');
            if(!target) return alert("Enter target!");
            out.innerHTML = "<span class='animate-pulse'>SCANNING...</span>";
            try {
                const res = await fetch('/api/osint', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({target})});
                const data = await res.json();
                out.innerHTML = data.results.length ? data.results.map(u => `<div>> FOUND: ${u}</div>`).join('') : "NO MATCHES";
            } catch(e) { out.innerHTML = "Error connecting to server."; }
        }

        async function startBreach() {
            const email = document.getElementById('breach_target').value;
            const out = document.getElementById('breach_res');
            if(!email) return alert("Enter email!");
            out.innerHTML = "QUERYING...";
            try {
                const res = await fetch('/api/breach', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email})});
                const data = await res.json();
                out.innerHTML = data.success ? `<span class='text-red-500'>EXPOSED IN ${data.result.length} LEAKS</span>` : "SAFE";
            } catch(e) { out.innerHTML = "Error connecting to server."; }
        }

        async function startForensic() {
            const file = document.getElementById('forensic_file').files[0];
            if(!file) return alert("Select file!");
            const fd = new FormData(); fd.append('file', file);
            const res = await fetch('/api/forensic', {method:'POST', body:fd});
            const data = await res.json();
            document.getElementById('forensic_res').innerHTML = JSON.stringify(data.meta || data.error, null, 2);
        }

        async function startWipe() {
            const log = document.getElementById('wipe_log');
            log.innerHTML = "[CHECKING AUTH]...";
            
            const res = await fetch('/api/wipe', {method:'POST'});
            const data = await res.json();

            if(data.status === "LOGIN_REQUIRED") {
                document.getElementById('loginModal').style.display = 'flex';
                log.innerHTML = "[ERROR] Auth Required. Login Modal Opened.";
            } else {
                log.innerHTML = "[AUTHORIZED] Starting 200,000 node erasure sequence...";
                const bar = document.getElementById('wipe_bar');
                for(let i=0; i<=100; i++) {
                    await new Promise(r => setTimeout(r, 50));
                    bar.style.width = i+"%";
                    if(i%5===0) log.innerHTML += `<br>> [WIPE] Node_${i*2000} data packet... DELETED`;
                    log.scrollTop = log.scrollHeight;
                }
                log.innerHTML += "<br><span class='text-green-500'>[SUCCESS] ALL TARGETS WIPED.</span>";
            }
        }
    </script>
</body>
</html>
